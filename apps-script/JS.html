<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
<script>

  window.addEventListener('load', searchData)

  // OB - Fallido --> Clientes

  const userId = document.getElementById('userId')
  const userName = document.getElementById('userName')
  const userLastName = document.getElementById('userLastName')
  const userPhone = document.getElementById('userPhone')
  const userDni = document.getElementById('userDni')
  const userCod = document.getElementById('userCod')
  const userReferent = document.getElementById('userReferent')
  const userStatusWeb = document.getElementById('userStatusWeb')
  const userCountry = document.getElementById('userCountry')
  const userProduct = document.getElementById('userProduct')
  const userStatusRisk = document.getElementById('userStatusRisk')
  const userDateOfFirstContact = document.getElementById('userDateOfFirstContact')
  const comentCallTitle = document.getElementById("comentCallTitle")
  const comentCallBtn = document.getElementById("comentCallBtn")
  const createUserOBF = document.getElementById("createUserOBF")
  const noComentsCall = document.getElementById('noComentsCall')
  const comentsCallsContainer = document.getElementById("comentsCallsContainer")
  const formValues = document.getElementById('createUser');
  const phoneMsgValidation = document.getElementById("error-message-phone")
  const countryMsgValidation = document.getElementById("error-message-country")
  const tableBody = document.getElementById('tableBody-users');
  const template = document.getElementById('rowTemplate')
  const target = document.getElementById("inputSearchClient")
  const searchloader = document.getElementById("searchClientLoader")
  const formValuesComentsCall = document.getElementById('createComentsCall');
  const agentName = document.getElementById("callAgentName")
  const viaOfCalling = document.getElementById("callViaOfCalling")
  const resultOfCalling = document.getElementById("callResults")
  const statusClient = document.getElementById("callStatusClient")
  const reasonToNotAfiliate = document.getElementById("callReasonToNotAfiliate")
  const commentsOfCalling = document.getElementById("callComentsOfCalling")
  const errorAgentName = document.getElementById("error-message-agentName")
  const errorCallViaOfCalling = document.getElementById("error-message-callViaOfCalling")
  const errorCallResults = document.getElementById("error-message-callResults")
  const errorCallStatusClient = document.getElementById("error-message-callStatusClient")
  const errorCallReasonToNotAfiliate = document.getElementById("error-message-callReasonToNotAfiliate")
  const errorCallComentsOfCalling = document.getElementById("error-message-callComentsOfCalling")


  function handleShowModalUser() {
    formValues.reset()
    document.getElementById("comentsCallsContainer").innerHTML = ""
    comentCallTitle.classList = "d-none"
    comentCallBtn.classList = "d-none"
    createUserOBF.parentNode.classList = "modal-footer d-flex justify-content-end"
    phoneMsgValidation.classList = "invalid-message d-none"
    userCountry.classList = "form-select"
    countryMsgValidation.classList = "d-none"
    noComentsCall.classList = "d-none"
    userPhone.classList = "form-control"

    userPhone.addEventListener("keyup", (event) => {
      if (validatePhoneNumber(event.target.value)) {
        phoneMsgValidation.classList = "d-none"
        userPhone.classList = "form-control"
      } else {
        userPhone.classList = "form-control invalid-input"
        phoneMsgValidation.classList = "invalid-message"
      }
    })

    userCountry.addEventListener("change", (event) => {
      if (event.target.value === "") {
        userCountry.classList = "form-select invalid-input"
        countryMsgValidation.classList = "invalid-message"
      } else {
        countryMsgValidation.classList = "d-none"
        userCountry.classList = "form-select"
      }
    })

  }

  // Function que activa y desactiva el loader de los identificadores de los elementos
  function loadingBtnOnOff(btn, loader) {
    document.querySelector(`#${btn}`).classList.toggle("d-none")
    document.querySelector(`#${loader}`).classList.toggle("d-none")
  }

  // Cuando se presiona el boton de editar, se obtienen los datos de la fila en cuestion para que sean mostrados en el formulario mostrando el modal para editarlos
  function handleUpdateUserInfo(button) {

    const tableRow = button.parentNode.parentNode;

    const id = button.dataset.usuarioId;

    const country = tableRow.cells[0].innerHTML;
    const name = tableRow.cells[1].innerHTML;
    const lastName = tableRow.cells[2].innerHTML;
    const phone = tableRow.cells[3].innerHTML;
    const dni = tableRow.cells[4].innerHTML;
    const cod = tableRow.cells[5].innerHTML;
    const referent = tableRow.cells[6].innerHTML;
    const dateOfFirstContact = tableRow.cells[7].innerHTML;
    const statusWeb = tableRow.cells[8].innerHTML;
    const product = tableRow.cells[9].innerHTML;
    const statusRisk = tableRow.cells[10].innerHTML;

    const createModal = bootstrap.Modal.getOrCreateInstance('#createModal');
    createModal.show()

    userId.value = id;
    userName.value = name;
    userLastName.value = lastName;
    userPhone.value = phone;
    userDni.value = dni;
    userCod.value = cod;
    userReferent.value = referent;
    userDateOfFirstContact.value = dateOfFirstContact;
    userStatusWeb.value = statusWeb;
    userCountry.value = country;
    userProduct.value = product;
    userStatusRisk.value = statusRisk;

    // Estilos de los botones y labels
    userCountry.classList = "form-select"
    countryMsgValidation.classList = "d-none"
    noComentsCall.classList = "d-none"
    comentCallTitle.classList = "fs-5 fw-semibold text-primary-emphasis inline-block justify-content-center mt-5 text-center"
    comentCallBtn.classList = "btn btn-outline-secondary"
    createUserOBF.parentNode.classList = "modal-footer d-flex justify-content-between"

    // Resetear valores de la tipificacion
    formValuesComentsCall.reset()

    getDataComentCalls(phone)
  }

  // Se llama la funcion cuando se presiona el boton de guardar, se valida el telefono y el pais
  function handleSaveChanges(e) {

    e.preventDefault()

    if (userCountry.value === "") {
      userCountry.classList = "form-select invalid-input"
      countryMsgValidation.classList = "invalid-message"
    }

    let passInputValidation = validatePhoneNumber(userPhone.value) && userCountry.value.length > 0

    if (validatePhoneNumber(userPhone.value)) {
      userPhone.classList = "form-control"
      phoneMsgValidation.classList = "d-none"
    } else {
      userPhone.classList = "form-control invalid-input"
      phoneMsgValidation.classList = "invalid-message"
    }

    if (passInputValidation) {
      validateForm()
    }
  }

  // Validamos los datos del formulario y generamos dos casos, uno para crear el usuario y el otro para actualizar los datos del mismo
  function validateForm() {
    loadingBtnOnOff("createUserOBF", "loadingButton")

    const form = {
      userId: userId.value,
      userName: userName.value,
      userLastName: userLastName.value,
      userPhone: userPhone.value,
      userDni: userDni.value,
      userCod: userCod.value,
      userReferent: userReferent.value,
      userDateOfFirstContact: userDateOfFirstContact.value,
      userStatusWeb: userStatusWeb.value,
      userCountry: userCountry.value,
      userProduct: userProduct.value,
      userStatusRisk: userStatusRisk.value,
    }

    if (form.userId === '') {
      //Create Client
      google.script.run
        .withSuccessHandler(result => {
          loadingBtnOnOff("createUserOBF", "loadingButton")
          searchData()
          formValues.reset();
          target.value = ""
          const createModal = bootstrap.Modal.getOrCreateInstance('#createModal');
          createModal.hide();
          handleSaveAlert('Usuario creado exitosamente!', 'success')
        })
        .addUser(form);
    } else {
      //Update Client
      google.script.run
        .withSuccessHandler(result => {
          loadingBtnOnOff("createUserOBF", "loadingButton")
          if (target.value === "") {
            searchData()
          } else {
            findClientByValue(target.value)
            getNumberOfPages(result)
          }

          formValues.reset()
          const createModal = bootstrap.Modal.getOrCreateInstance('#createModal');
          createModal.hide();
          handleSaveAlert('Usuario actualizado exitosamente!', 'success')
        })
        .editUser(form)
    }
  }

  // Buscamos los datos de la tabla y lo mostramos en un template predefinido para posteriormente mostralos
  function searchData() {

    tableBody.innerHTML = ''

    searchloader.classList = "position-absolute top-50 start-50 translate-middle"

    google.script.run
      .withSuccessHandler(usersData => {
        let templateContent = template.content;

        searchloader.classList = "d-none"

        getNumberOfPages(usersData)

        usersData.reverse().forEach(user => {
          const tr = templateContent.cloneNode(true)

          const nameCol = tr.querySelector(".template-name");
          const lastNameCol = tr.querySelector(".template-lastName");
          const countryCol = tr.querySelector(".template-country");
          const phoneCol = tr.querySelector(".template-phone");
          const dniCol = tr.querySelector(".template-dni");
          const codCol = tr.querySelector(".template-cod");
          const referenteCol = tr.querySelector(".template-referent");
          const dateOfFirstContactCol = tr.querySelector(".template-dateOfFirstContact");
          const statusWebCol = tr.querySelector(".template-statusWeb");
          const productCol = tr.querySelector(".template-product");
          const statusRiskCol = tr.querySelector(".template-statusRisk");

          const actionCol = tr.querySelector(".template-actions");
          const editButton = tr.querySelector(".button-edit");

          countryCol.textContent = user[1]
          nameCol.textContent = user[2]
          lastNameCol.textContent = user[3]
          phoneCol.textContent = user[4]
          dniCol.textContent = user[5]
          codCol.textContent = user[6]
          referenteCol.textContent = user[7]
          dateOfFirstContactCol.textContent = user[8]
          statusWebCol.textContent = user[9]
          productCol.textContent = user[10]
          statusRiskCol.textContent = user[11]

          editButton.dataset.usuarioId = user[0]

          tableBody.appendChild(tr);
        })
      })
      .readUsers()

  }

  // Valida el numero de telefono para que solo tenga numeros entres 9 y 10 en total
  function validatePhoneNumber(phoneNumber) {

    let phoneNumberTrim = phoneNumber.trim()

    // Check if the phone number is nine digits long.
    if (phoneNumberTrim.length < 9 || phoneNumberTrim.length > 10) {
      return false;
    }

    // Check if the phone number only contains digits.
    for (var i = 0; i < phoneNumberTrim.length; i++) {
      if (phoneNumberTrim.charAt(i) !== "0" && phoneNumberTrim.charAt(i) !== "1" && phoneNumberTrim.charAt(i) !== "2" && phoneNumberTrim.charAt(i) !== "3" && phoneNumberTrim.charAt(i) !== "4" && phoneNumberTrim.charAt(i) !== "5" && phoneNumberTrim.charAt(i) !== "6" && phoneNumberTrim.charAt(i) !== "7" && phoneNumberTrim.charAt(i) !== "8" && phoneNumberTrim.charAt(i) !== "9") {
        return false;
      }
    }
    // The phone number is valid.
    return true;
  }

  // Funcion que muestra una alerta si se registra, actualiza o se crea una nueva tipificacion
  function handleSaveAlert(message, type) {
    const alertPlaceholder = document.getElementById('liveAlertPlaceholder')
    const appendAlert = (message, type) => {
      const wrapper = document.createElement('div')
      wrapper.innerHTML = [
        `<div class="alert alert-${type} alert-dismissible" role="alert">`,
        `   <div>${message}</div>`,
        '   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>',
        '</div>'
      ].join('')

      alertPlaceholder.append(wrapper)
    }

    const alertTrigger = document.getElementById('createUserOBF')
    if (alertTrigger) {
      appendAlert(message, type)
    }
  }

  function handleRefreshTable() {
    searchData()
    target.value = ""
  }


  // Tipificaciones

  // Funcion que muestra todas la tipificaciones realizadas tanto del drive reciente con del antigua, como historial para no perder datos
  function getDataComentCalls(target) {

    document.querySelector('#loadingComenstCall').classList.toggle("d-none")
    comentsCallsContainer.innerHTML = ""

    google.script.run
      .withSuccessHandler(({ newComentsCall, oldComentsCall }) => {
        document.querySelector('#loadingComenstCall').classList.toggle("d-none")

        let filterComentsCalls = newComentsCall
          .filter(comentCall => comentCall[2] === target)
          .sort((comentCall, nextComentCall) => new Date(`${nextComentCall[3]}, ${nextComentCall[4]}`) - new Date(`${comentCall[3]}, ${comentCall[4]}`))

        const comentsCallTemplate = document.getElementById("comentsCallTemplate")
        const templateItem = comentsCallTemplate.content;

        filterComentsCalls.forEach((call, index) => {
          const comentCallItem = templateItem.cloneNode(true)

          const headerCallItem = comentCallItem.querySelector(".accordion-button")
          const bodyCallItem = comentCallItem.querySelector(".accordion-body")

          // Configuracion del acodion donde se muestran los comentarios de la llamada
          headerCallItem.dataset.bsTarget = `#panel-${index}`
          headerCallItem.setAttribute("aria-controls", `panel-${index}`)

          if (index === 0) {
            headerCallItem.classList = "accordion-button"
            headerCallItem.setAttribute("aria-expanded", "true")
            bodyCallItem.parentNode.classList = "accordion-collapse collapse show"
          }

          bodyCallItem.parentNode.setAttribute("id", `panel-${index}`)


          // Contenedor del comentario de la llamada
          headerCallItem.textContent = `Llamada: ${call[3]} - ${call[4]} - ${call[9]}`

          // Informacion adicional de la llamada
          bodyCallItem.innerHTML =
            `<div class="d-flex flex-column gap-2">
              <div class="d-flex justify-content-between p-3">
                <div class="d-flex gap-2">
                  <p class="fw-bolder">Medio de contacto: </p>
                  <p class="fw-normal">${call[1] || "NULL"}</p>
                </div>
                <div class="d-flex gap-2">
                  <p class="fw-bolder">Fecha: </p>
                  <p class="fw-normal">${call[3]}</p>
                </div>
                <div class="d-flex gap-2">
                  <p class="fw-bolder">Hora: </p>
                  <p class="fw-normal">${call[4]}</p>
                </div>
              </div>
              <div class="bg-info bg-opacity-10 px-2 py-3 rounded d-flex flex-column justify-content-between">
                <div class="d-flex gap-2 px-2">
                  <p class="fw-bolder">Resultado:</p>
                  <p class="fw-normal">${call[5] || "NULL"}</p>
                </div>
                <div class="d-flex gap-2 px-2">
                  <p class="fw-bolder text-wrap">Estatus de la gestión: </p>
                  <p class="fw-normal">${call[7] || "NULL"}</p>
                </div>
                <div class="d-flex gap-2 bg-danger rounded p-2 bg-opacity-25">
                  <p class="fw-bolder text-wrap">Motivo de no afiliación: </p>
                  <p class="fw-normal">${call[8] || "NULL"}</p>
                </div>
                <div class="d-flex gap-2 mt-3 bg-success p-2 text-dark bg-opacity-25 rounded">
                  <p class="fw-bolder text-wrap">Comentarios: </p>
                  <p class="fw-normal">${call[6] || "NULL"}</p>
                </div>
                <div class="d-flex gap-2 mt-3 justify-content-center">
                  <p class="fw-bolder text-wrap">Asesor: </p>
                  <p class="fw-normal">${call[9] || "NULL"}</p>
                </div>
              </div>
            </div>`

          comentsCallsContainer.appendChild(comentCallItem)
        })

        generateOldComentsCall(templateItem, oldComentsCall, target)

        // Aplicar estilos a las etiquelas para mayor informacion al usuario
        if (filterComentsCalls.length > 0) {
          comentsCallsContainer.classList = "accordion mt-0 mb-3"
          noComentsCall.classList = "d-none"
          comentCallTitle.classList = "fs-5 fw-semibold text-primary-emphasis inline-block justify-content-center mt-5 text-center"
        }

        comentsCallsContainer.style.display = "block"

      })
      .readComentsCall()
  }

  // Funcion que muestra las tipificaciones creadas en el antiguio formulario y que se muestra como historial
  function generateOldComentsCall(templateItem, oldComentsCall, target) {
    const comentCallItem = templateItem.cloneNode(true)

    const headerCallItem = comentCallItem.querySelector(".accordion-button")
    const bodyCallItem = comentCallItem.querySelector(".accordion-body")

    headerCallItem.dataset.bsTarget = `#panel-old`
    headerCallItem.setAttribute("aria-controls", `panel-old`)

    bodyCallItem.parentNode.setAttribute("id", `panel-old`)

    headerCallItem.textContent = "Tipificaciones antiguas"

    const rowOldComentsCall = oldComentsCall.find(telefono => telefono[4] === target) || -1

    const sliceRowOldComentsCall = rowOldComentsCall !== -1 ? rowOldComentsCall.slice(12,) : -1

    if (sliceRowOldComentsCall === -1 || sliceRowOldComentsCall.every(elem => elem === "")) {
      comentsCallsContainer.classList.toggle("d-none")
      noComentsCall.classList = "fs-5 fw-semibold text-primary-emphasis d-flex justify-content-center mt-5 mb-3"
      comentCallTitle.classList = "d-none"
    } else {
      comentsCallsContainer.classList = "accordion mt-0 mb-3"
      let counterCalls = ""
      sliceRowOldComentsCall.forEach((comentsCall, index) => {

        if ((index + 1) % 3 === 0 && (index + 1) < 10) {
          counterCalls +=
            `
            <div class="row my-0">
              <div class="col-5 bg-transparent border border-0">
                <p><strong>${Math.ceil(index / 3)}° Llamada - Fecha:</strong> ${sliceRowOldComentsCall[index - 1] || "Sin registro"}</p>
              </div>
              <div class="col bg-transparent border border-0">
                <p><strong>Medio:</strong> ${sliceRowOldComentsCall[index - 2] || "Sin registro"}</p>
              </div>
              <div class="col-4 bg-transparent border border-0">
                <p><strong>Resultado:</strong> ${sliceRowOldComentsCall[index] || "Sin registro"}</p>
              </div>
            </div>
            `
        }
      })

      bodyCallItem.innerHTML =
        `
          <div class="d-flex flex-column px-3 mt-5 mb-2">
            ${counterCalls}
          </div>
          <div class="bg-info bg-opacity-10 px-2 py-3 rounded d-flex flex-column justify-content-between">
            <div class="d-flex gap-2 px-2">
              <p class="fw-bolder text-wrap">Estatus de la gestión: </p>
              <p class="fw-normal">${sliceRowOldComentsCall[10] || "Sin registro"}</p>
            </div>
            <div class="d-flex gap-2 bg-danger rounded p-2 bg-opacity-25">
              <p class="fw-bolder text-wrap">Motivo de no afiliación: </p>
              <p class="fw-normal">${sliceRowOldComentsCall[11] || "Sin registro"}</p>
            </div>
            <div class="d-flex gap-2 mt-3 bg-success p-2 text-dark bg-opacity-25 rounded">
              <p class="fw-bolder text-wrap">Comentarios: </p>
              <p class="fw-normal">${sliceRowOldComentsCall[9] || "Sin registro"}</p>
            </div>
            <div class="d-flex gap-2 mt-3 justify-content-center">
              <p class="fw-bolder text-wrap">Asesor: </p>
              <p class="fw-normal">${sliceRowOldComentsCall[12] || "Sin registro"}</p>
            </div>
          </div>
        `

      comentsCallsContainer.appendChild(comentCallItem)
    }
  }

  // 

  function handleModalComentsCall() {

    agentName.addEventListener("keyup", (event) => {
      if (event.target.value === "") {
        agentName.classList = "form-control invalid-input"
        errorAgentName.classList = "invalid-message"
      } else {
        errorAgentName.classList = "d-none"
        agentName.classList = "form-control"
      }
    })

    viaOfCalling.addEventListener("change", (event) => {
      if (event.target.value === "") {
        viaOfCalling.classList = "form-select invalid-input"
        errorCallViaOfCalling.classList = "invalid-message"
      } else {
        errorCallViaOfCalling.classList = "d-none"
        viaOfCalling.classList = "form-select"
      }
    })

    resultOfCalling.addEventListener("change", (event) => {
      if (event.target.value === "") {
        resultOfCalling.classList = "form-select invalid-input"
        errorCallResults.classList = "invalid-message"
      } else {
        errorCallResults.classList = "d-none"
        resultOfCalling.classList = "form-select"
      }
    })

    statusClient.addEventListener("change", (event) => {
      if (event.target.value === "") {
        statusClient.classList = "form-select invalid-input"
        errorCallStatusClient.classList = "invalid-message"
      } else {
        errorCallStatusClient.classList = "d-none"
        statusClient.classList = "form-select"
      }
    })

    reasonToNotAfiliate.addEventListener("change", (event) => {
      if (event.target.value === "") {
        reasonToNotAfiliate.classList = "form-select invalid-input"
        errorCallReasonToNotAfiliate.classList = "invalid-message"
      } else {
        errorCallReasonToNotAfiliate.classList = "d-none"
        reasonToNotAfiliate.classList = "form-select"
      }
    })

    commentsOfCalling.addEventListener("keyup", (event) => {
      if (event.target.value === "") {
        commentsOfCalling.classList = "form-control invalid-input"
        errorCallComentsOfCalling.classList = "invalid-message"
      } else {
        errorCallComentsOfCalling.classList = "d-none"
        commentsOfCalling.classList = "form-control"
      }
    })

  }

  // Funcion que muestra un modal para ingresar y guarda los datos de la tificacio, ademas muestra un alerta cuando se realiza correctamente
  function addComentsCallHandler() {

    loadingBtnOnOff("saveCommentsCallBtn", "loadingButtonCommentsCall")

    const form = {
      clientPhone: document.getElementById("userPhone").value,
      callViaOfCalling: document.getElementById("callViaOfCalling").value,
      callAgentName: document.getElementById("callAgentName").value,
      callResults: document.getElementById("callResults").value,
      callStatusClient: document.getElementById("callStatusClient").value,
      callReasonToNotAfiliate: document.getElementById("callReasonToNotAfiliate").value,
      callComentsOfCalling: document.getElementById("callComentsOfCalling").value
    }

    google.script.run
      .withSuccessHandler(result => {

        loadingBtnOnOff("saveCommentsCallBtn", "loadingButtonCommentsCall")
        formValuesComentsCall.reset()
        const createModal = bootstrap.Modal.getOrCreateInstance('#secondaryModal');
        createModal.hide();
        handleSaveAlert('Tipificación creada exitosamente!', 'success')
        formValuesComentsCall.reset()
      })
      .addComentsCall(form)

  }

  // Funcion que maneja las acciones cuando se guardan las tipificaciones
  function handleSaveComentsCall(event) {

    event.preventDefault()

    if (agentName.value === "" || viaOfCalling.value === "" || resultOfCalling.value === "" || statusClient.value === "" || reasonToNotAfiliate.value === "" || commentsOfCalling.value === "") {
      agentName.classList = "form-control invalid-input"
      viaOfCalling.classList = "form-select invalid-input"
      resultOfCalling.classList = "form-select invalid-input"
      statusClient.classList = "form-select invalid-input"
      reasonToNotAfiliate.classList = "form-select invalid-input"
      commentsOfCalling.classList = "form-control invalid-input"
      errorAgentName.classList = "invalid-message"
      errorCallViaOfCalling.classList = "invalid-message"
      errorCallResults.classList = "invalid-message"
      errorCallStatusClient.classList = "invalid-message"
      errorCallReasonToNotAfiliate.classList = "invalid-message"
      errorCallComentsOfCalling.classList = "invalid-message"
    } else {
      agentName.classList = "form-control"
      viaOfCalling.classList = "form-select"
      resultOfCalling.classList = "form-select"
      statusClient.classList = "form-select"
      reasonToNotAfiliate.classList = "form-select"
      commentsOfCalling.classList = "form-control"
      errorAgentName.classList = "d-none"
      errorCallViaOfCalling.classList = "d-none"
      errorCallResults.classList = "d-none"
      errorCallStatusClient.classList = "d-none"
      errorCallReasonToNotAfiliate.classList = "d-none"
      errorCallComentsOfCalling.classList = "d-none"
      addComentsCallHandler()
    }

  }


  // Buscador

  // Funcion que busca y muestra las informacion de un cliente
  function handleFindClientByValue(event) {

    event.preventDefault()

    findClientByValue(target.value)
  }

  function findClientByValue(target) {
    tableBody.innerHTML = ''

    searchloader.classList = "position-absolute top-50 start-50 translate-middle"

    google.script.run
      .withSuccessHandler(userData => {
        let templateContent = template.content;

        searchloader.classList = "d-none"

        userData.forEach(user => {
          const tr = templateContent.cloneNode(true)

          const nameCol = tr.querySelector(".template-name");
          const lastNameCol = tr.querySelector(".template-lastName");
          const countryCol = tr.querySelector(".template-country");
          const phoneCol = tr.querySelector(".template-phone");
          const dniCol = tr.querySelector(".template-dni");
          const codCol = tr.querySelector(".template-cod");
          const referenteCol = tr.querySelector(".template-referent");
          const dateOfFirstContactCol = tr.querySelector(".template-dateOfFirstContact");
          const statusWebCol = tr.querySelector(".template-statusWeb");
          const productCol = tr.querySelector(".template-product");
          const statusRiskCol = tr.querySelector(".template-statusRisk");

          const actionCol = tr.querySelector(".template-actions");
          const editButton = tr.querySelector(".button-edit");

          countryCol.textContent = user[1]
          nameCol.textContent = user[2]
          lastNameCol.textContent = user[3]
          phoneCol.textContent = user[4]
          dniCol.textContent = user[5]
          codCol.textContent = user[6]
          referenteCol.textContent = user[7]
          dateOfFirstContactCol.textContent = user[8]
          statusWebCol.textContent = user[9]
          productCol.textContent = user[10]
          statusRiskCol.textContent = user[11]

          editButton.dataset.usuarioId = user[0]

          tableBody.appendChild(tr);
        })
      })
      .findUserByValue(target)
  }

  // Paginacion

  function getNumberOfPages(usersList) {
    const listOfPages = document.getElementById("listOfPages")
    const numberOfPages = Math.ceil((usersList.length / 5))

    let listOfPagesBtn = ""

    for (let i = 0; i < numberOfPages; i++) {
      listOfPagesBtn +=
        `<li class="page-item"><a class="page-link" href="#" onclick="handleChangePage(event,${i})">${i + 1}</a></li>`
    }

    listOfPages.innerHTML =
      ` <li class="page-item">
        <li class="page-item disabled">
          <span class="page-link rounded-start">Anterior</span>
        </li>
        ${listOfPagesBtn}
        <li class="page-item">
          <a class="page-link" href="#">Siguiente</a>
      </li>
      `
  }

  function handleChangePage(event, index) {
    event.preventDefault()
    console.log(index + 1)
  }
</script>
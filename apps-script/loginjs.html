<script>

  const formLogin = document.getElementById("form-login")
  const loadingLoggingBtn = document.getElementById("loadingLoggingBtn")
  const loggingBtn = document.getElementById("loggingBtn")


  formLogin.addEventListener("submit", (event) => {
    event.preventDefault()

    loggingBtn.classList.add("d-none")
    loadingLoggingBtn.classList.remove("d-none")

    formLogin.classList.add("was-validated")

    const email = document.getElementById("loggingEmail").value;
    const password = document.getElementById("loggingPassword").value;

    google.script.run
      .withSuccessHandler(saveData)
      .validateCredentials(email, password)
  })

  const saveData = (result) => {
    // Almacena el objeto en el localStorage
    localStorage.setItem('autenticado', result.authorization)
    localStorage.setItem('name', result.name)
    localStorage.setItem('email', result.email)
    localStorage.setItem('role', result.role)

    loggingBtn.removeAttribute("disabled")

    if (result.authorization == "200") {
      google.script.run
        .withSuccessHandler((url) => {
          window.open(url, "_top")
          loadingLoggingBtn.classList.add("d-none")
          loggingBtn.classList.remove("d-none")
          loggingBtn.setAttribute("disabled", "")
        })
        .getPageUrl("index")
    } else {
      console.log("Datos incorrectos")
      return
    }
  }

</script>